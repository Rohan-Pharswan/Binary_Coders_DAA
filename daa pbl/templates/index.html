<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Disaster Relief Management System</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2196F3;
            --success: #4CAF50;
            --warning: #FFC107;
            --danger: #f44336;
            --gray: #9E9E9E;
        }
        
        * { box-sizing: border-box; }
        
        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            color: var(--primary);
            margin: 0;
        }
        
        .header p {
            color: var(--gray);
            margin: 10px 0 0;
        }
        
        .card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        input, select, button {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        button {
            background: var(--primary);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.3s;
        }
        
        button:hover {
            background: #1976D2;
        }
        
        button.secondary {
            background: white;
            border: 1px solid var(--primary);
            color: var(--primary);
        }
        
        button.secondary:hover {
            background: #f5f5f5;
        }
        
        .item-list {
            max-height: 300px;
            overflow-y: auto;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 10px 0;
        }
        
        .item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .item:last-child {
            border-bottom: none;
        }
        
        .item .input-group {
            min-width: 150px;
            flex: 1;
        }
        
        .remove-btn {
            background: var(--danger);
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .map-container {
            width: 100%;
            height: 400px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 10px 0;
            position: relative;
        }
        
        .node {
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            cursor: move;
        }
        
        .node.warehouse { background: lightgreen; }
        .node.affected { background: #ff9999; }
        .node.hospital { background: #99ccff; }
        .node.shelter { background: #ffcc99; }
        
        .edge {
            position: absolute;
            height: 2px;
            background: #666;
            transform-origin: 0 0;
        }
        
        .legend {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin: 10px 0;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .color-box {
            width: 15px;
            height: 15px;
            border-radius: 3px;
        }
        
        .demand-section {
            margin-top: 10px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: #f9f9f9;
        }
        .demand-items {
            max-height: 100px;
            overflow-y: auto;
            margin-top: 5px;
        }
        .demand-checkbox {
            display: flex;
            align-items: center;
            gap: 5px;
            margin: 3px 0;
        }
        .demand-checkbox input[type="checkbox"] {
            width: auto;
        }
        
        /* Tooltip styles */
        .tooltip-container {
            position: relative;
            display: inline-block;
            width: 100%;
            overflow: visible;
        }
        
        .tooltip {
            position: fixed;
            background: #333;
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
            pointer-events: none;
            max-width: 250px;
            white-space: normal;
            line-height: 1.4;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .tooltip-container:hover .tooltip {
            opacity: 1;
            visibility: visible;
        }
        
        .tooltip.top {
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            white-space: normal;
            max-width: 300px;
            word-wrap: break-word;
        }
        
        .tooltip.top::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #333 transparent transparent transparent;
        }
        
        .tooltip.right {
            left: 100%;
            top: 50%;
            transform: translateY(-50%);
            margin-left: 5px;
        }
        
        .tooltip.right::after {
            content: '';
            position: absolute;
            top: 50%;
            right: 100%;
            margin-top: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: transparent #333 transparent transparent;
        }
        
        .help-icon {
            display: inline-block;
            width: 16px;
            height: 16px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 16px;
            font-size: 10px;
            font-weight: bold;
            cursor: help;
            margin-left: 5px;
        }
        
        .input-group {
            position: relative;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .input-group input,
        .input-group select {
            flex: 1;
        }
        
        /* Food category styles */
        .food-category {
            margin-bottom: 10px;
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
        
        .food-category.food {
            background-color: #e8f5e8;
            border-color: var(--success);
        }
        
        .food-category.non-food {
            background-color: #fff3e0;
            border-color: var(--warning);
        }
        
        .category-label {
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 5px;
            display: block;
        }
        
        .food-category.food .category-label {
            color: var(--success);
        }
        
        .food-category.non-food .category-label {
            color: var(--warning);
        }
        
        .error-message {
            color: var(--danger);
            font-size: 12px;
            margin-top: 5px;
            display: none;
            background-color: #ffebee;
            padding: 5px;
            border-radius: 3px;
            border: 1px solid var(--danger);
        }
        
        .section-description {
            font-size: 14px;
            font-weight: normal;
            color: var(--gray);
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üö® Disaster Relief Management System</h1>
            <p>Optimize relief operations with advanced algorithms for efficient supply distribution and route planning</p>
        </div>

        <form id="simulation-form" method="post" action="/run">
            <div class="grid">
                <!-- Supply Management -->
                <div class="card">
                    <h2>üì¶ Supply Management <span class="section-description">- Defines available supplies at warehouse with priority values and weight constraints</span></h2>
                    <button type="button" onclick="addSupply()" class="secondary">+ Add Supply Item</button>
                    <div id="supplies" class="item-list"></div>
                    <input type="hidden" id="supply_count" name="supply_count" value="0">
                </div>

                <!-- Vehicle Fleet -->
                <div class="card">
                    <h2>üöõ Vehicle Fleet <span class="section-description">- Configures transportation vehicles with capacity limits for delivery operations</span></h2>
                    <button type="button" onclick="addVehicle()" class="secondary">+ Add Vehicle</button>
                    <div id="vehicles" class="item-list"></div>
                    <input type="hidden" id="vehicle_count" name="vehicle_count" value="0">
                </div>
            </div>

            <!-- Network Setup -->
            <div class="card">
                <h2>üó∫Ô∏è Network Setup <span class="section-description">- Creates the basic network structure with locations and connecting roads</span></h2>
                <div class="legend">
                    <div class="legend-item">
                        <div class="color-box" style="background: lightgreen;"></div>
                        <span>Warehouse</span>
                    </div>
                    <div class="legend-item">
                        <div class="color-box" style="background: #ff9999;"></div>
                        <span>Affected Area</span>
                    </div>
                    <div class="legend-item">
                        <div class="color-box" style="background: #99ccff;"></div>
                        <span>Hospital</span>
                    </div>
                    <div class="legend-item">
                        <div class="color-box" style="background: #ffcc99;"></div>
                        <span>Shelter</span>
                    </div>
                </div>
                
                <div class="grid">
                    <div>
                        <button type="button" onclick="addNode()" class="secondary">+ Add Location</button>
                        <div id="nodes" class="item-list"></div>
                        <input type="hidden" id="node_count" name="node_count" value="0">
                    </div>
                    <div>
                        <button type="button" onclick="addEdge()" class="secondary">+ Add Road</button>
                        <div id="edges" class="item-list"></div>
                        <input type="hidden" id="edge_count" name="edge_count" value="0">
                    </div>
                </div>
                
                <div class="map-container" id="network-map">
                    <!-- Network visualization will be rendered here -->
                </div>
            </div>

            <div class="card">
                <h2>‚ñ∂ Run Simulation <span class="section-description">- Executes the optimization algorithms to find optimal delivery routes and assignments</span></h2>
                <button type="submit">Start Simulation</button>
            </div>
        </form>
    </div>

    <script>
        let supplyCount = 0;
        let vehicleCount = 0;
        let nodeCount = 0;
        let edgeCount = 0;
        let nodes = [];
        let edges = [];

        function removeItem(element, type) {
            element.parentElement.remove();
            if (type === 'supply') {
                supplyCount--;
                document.getElementById("supply_count").value = supplyCount;
                reindexItems('supplies', 'supply');
            } else if (type === 'vehicle') {
                vehicleCount--;
                document.getElementById("vehicle_count").value = vehicleCount;
                reindexItems('vehicles', 'vehicle');
            } else if (type === 'node') {
                nodeCount--;
                document.getElementById("node_count").value = nodeCount;
                reindexItems('nodes', 'node');
            } else if (type === 'edge') {
                edgeCount--;
                document.getElementById("edge_count").value = edgeCount;
                reindexItems('edges', 'edge');
            }
        }

        function reindexItems(containerId, prefix) {
            const container = document.getElementById(containerId);
            const items = container.children;
            for(let i = 0; i < items.length; i++) {
                const inputs = items[i].getElementsByTagName('input');
                for(let input of inputs) {
                    const name = input.getAttribute('name');
                    if(name && name.startsWith(`${prefix}_`)) {
                        const newName = name.replace(/\d+/, i);
                        input.setAttribute('name', newName);
                    }
                }
                const selects = items[i].getElementsByTagName('select');
                for(let select of selects) {
                    const name = select.getAttribute('name');
                    if(name && name.startsWith(`${prefix}_`)) {
                        const newName = name.replace(/\d+/, i);
                        select.setAttribute('name', newName);
                    }
                }
            }
        }

        function addSupply() {
            const div = document.getElementById("supplies");
            const item = document.createElement("div");
            item.className = "item";
            item.innerHTML = `
                <div class="input-group">
                    <div class="tooltip-container">
                        <input name="supply_name_${supplyCount}" placeholder="Supply Name" required style="flex: 2" onchange="validateSupplyCategory(this, ${supplyCount})">
                        <div class="tooltip top">Enter the name of the supply item (e.g., Water, Food, Medicine, Blankets)</div>
                    </div>
                    <span class="help-icon" title="Supply name">?</span>
                </div>
                <div class="input-group">
                    <div class="tooltip-container">
                        <select name="supply_category_${supplyCount}" onchange="validateCategorySelection(this, ${supplyCount})" required style="flex: 1">
                            <option value="">Select Category</option>
                            <option value="food">Food</option>
                            <option value="non-food">Non-Food</option>
                        </select>
                        <div class="tooltip top">Select whether this is a food or non-food item. Food items have 10% higher capacity requirements</div>
                    </div>
                    <span class="help-icon" title="Supply category">?</span>
                </div>
                <div class="input-group">
                    <div class="tooltip-container">
                        <input name="supply_value_${supplyCount}" type="number" min="0.1" step="0.1" placeholder="Value" required style="flex: 1">
                        <div class="tooltip top">Enter the priority value (1-100). Higher values indicate more critical supplies</div>
                    </div>
                    <span class="help-icon" title="Supply value">?</span>
                </div>
                <div class="input-group">
                    <div class="tooltip-container">
                        <input name="supply_weight_${supplyCount}" type="number" min="0.1" step="0.1" placeholder="Weight" required style="flex: 1">
                        <div class="tooltip top">Enter the weight. Food items have 10% higher capacity requirements</div>
                    </div>
                    <span class="help-icon" title="Supply weight">?</span>
                </div>
                <div class="food-category" id="food_options_${supplyCount}" style="display: none;">
                    <span class="category-label">Food Item Options</span>
                    <div class="input-group">
                        <div class="tooltip-container">
                            <select name="food_type_${supplyCount}" onchange="updateWeightPlaceholder(this, ${supplyCount})" style="flex: 1">
                                <option value="">Select Type</option>
                                <option value="solid">Solid</option>
                                <option value="liquid">Liquid</option>
                            </select>
                            <div class="tooltip top">Select whether this food item is solid (measured in kg) or liquid (measured in liters)</div>
                        </div>
                        <span class="help-icon" title="Food type">?</span>
                    </div>
                </div>
                <div class="error-message" id="error_${supplyCount}"></div>
                <span class="remove-btn" onclick="removeItem(this, 'supply')">‚úï</span>
            `;
            div.appendChild(item);
            supplyCount++;
            document.getElementById("supply_count").value = supplyCount;
        }

        function addVehicle() {
            const div = document.getElementById("vehicles");
            const item = document.createElement("div");
            item.className = "item";
            item.innerHTML = `
                <div class="input-group">
                    <div class="tooltip-container">
                        <input name="vehicle_name_${vehicleCount}" placeholder="Vehicle Name" required style="flex: 2">
                        <div class="tooltip top">Enter a descriptive name for the vehicle (e.g., Truck 1, Medical Van, Emergency Vehicle)</div>
                    </div>
                    <span class="help-icon" title="Vehicle name">?</span>
                </div>
                <div class="input-group">
                    <div class="tooltip-container">
                        <input name="vehicle_capacity_${vehicleCount}" type="number" min="0.1" step="0.1" placeholder="Capacity (kg)" required style="flex: 1">
                        <div class="tooltip top">Enter the maximum weight capacity in kilograms. Determines how much supplies can be transported</div>
                    </div>
                    <span class="help-icon" title="Vehicle capacity">?</span>
                </div>
                <span class="remove-btn" onclick="removeItem(this, 'vehicle')">‚úï</span>
            `;
            div.appendChild(item);
            vehicleCount++;
            document.getElementById("vehicle_count").value = vehicleCount;
        }

        function addNode() {
            const div = document.getElementById("nodes");
            const item = document.createElement("div");
            item.className = "item";
            item.innerHTML = `
                <div class="input-group">
                    <div class="tooltip-container">
                        <input name="node_name_${nodeCount}" placeholder="Location Name" required style="flex: 2">
                        <div class="tooltip top">Enter a unique name for this location (e.g., Central Warehouse, Hospital A, Shelter B)</div>
                    </div>
                    <span class="help-icon" title="Location name">?</span>
                </div>
                <div class="input-group">
                    <div class="tooltip-container">
                        <select name="node_type_${nodeCount}" onchange="toggleDemandSection(this, ${nodeCount})" required style="flex: 1">
                            <option value="Warehouse">Warehouse</option>
                            <option value="Affected">Affected Area</option>
                            <option value="Hospital">Hospital</option>
                            <option value="Shelter">Shelter</option>
                        </select>
                        <div class="tooltip top">Select the type of location. Warehouses store supplies, other locations need supplies delivered</div>
                    </div>
                    <span class="help-icon" title="Location type">?</span>
                </div>
                <div class="input-group">
                    <div class="tooltip-container">
                        <input name="node_x_${nodeCount}" type="number" step="0.1" placeholder="X" required style="flex: 1">
                        <div class="tooltip top">X coordinate (0-100). Used for distance calculations and visual representation</div>
                    </div>
                    <span class="help-icon" title="X coordinate">?</span>
                </div>
                <div class="input-group">
                    <div class="tooltip-container">
                        <input name="node_y_${nodeCount}" type="number" step="0.1" placeholder="Y" required style="flex: 1">
                        <div class="tooltip top">Y coordinate (0-100). Used for distance calculations and visual representation</div>
                    </div>
                    <span class="help-icon" title="Y coordinate">?</span>
                </div>
                <div class="demand-section" id="demand_${nodeCount}" style="display: none; flex: 2">
                    <div class="tooltip-container">
                        <button type="button" onclick="toggleAllItems(${nodeCount})" class="secondary" style="margin: 5px">All Items</button>
                        <div class="tooltip top">Select which supplies this location needs. Warehouses don't need supplies as they store them</div>
                    </div>
                    <span class="help-icon" title="Demand selection">?</span>
                    <div id="demand_items_${nodeCount}" class="demand-items"></div>
                </div>
                <span class="remove-btn" onclick="removeItem(this, 'node')">‚úï</span>
            `;
            div.appendChild(item);
            nodeCount++;
            document.getElementById("node_count").value = nodeCount;
            updateVisualization();
        }

        function toggleDemandSection(select, nodeId) {
            const demandSection = document.getElementById(`demand_${nodeId}`);
            const demandItems = document.getElementById(`demand_items_${nodeId}`);
            
            if (select.value !== 'Warehouse') {
                demandSection.style.display = 'block';
                updateDemandItems(nodeId);
            } else {
                demandSection.style.display = 'none';
                demandItems.innerHTML = '';
            }
        }

        function updateDemandItems(nodeId) {
            const demandItems = document.getElementById(`demand_items_${nodeId}`);
            demandItems.innerHTML = '';
            
            // Get all available supplies
            const supplies = document.getElementById("supplies").children;
            for (let supply of supplies) {
                const supplyName = supply.querySelector('input[name^="supply_name_"]').value;
                if (supplyName) {
                    const checkbox = document.createElement('div');
                    checkbox.className = 'demand-checkbox';
                    checkbox.innerHTML = `
                        <input type="checkbox" name="demand_${nodeId}_${supplyName}" id="demand_${nodeId}_${supplyName}">
                        <label for="demand_${nodeId}_${supplyName}">${supplyName}</label>
                    `;
                    demandItems.appendChild(checkbox);
                }
            }
        }

        function toggleAllItems(nodeId) {
            const demandItems = document.getElementById(`demand_items_${nodeId}`);
            const checkboxes = demandItems.querySelectorAll('input[type="checkbox"]');
            const allChecked = Array.from(checkboxes).every(cb => cb.checked);
            
            checkboxes.forEach(cb => {
                cb.checked = !allChecked;
            });
        }

        // Add observer for supply changes to update demand sections
        const suppliesContainer = document.getElementById("supplies");
        const suppliesObserver = new MutationObserver(() => {
            for (let i = 0; i < nodeCount; i++) {
                updateDemandItems(i);
            }
        });
        suppliesObserver.observe(suppliesContainer, { childList: true, subtree: true });

        function addEdge() {
            const div = document.getElementById("edges");
            const item = document.createElement("div");
            item.className = "item";
            item.innerHTML = `
                <div class="input-group">
                    <div class="tooltip-container">
                        <input name="edge_from_${edgeCount}" placeholder="From Location" required style="flex: 2" list="node-list">
                        <div class="tooltip top">Enter the name of the starting location. Must match an existing location name</div>
                    </div>
                    <span class="help-icon" title="From location">?</span>
                </div>
                <div class="input-group">
                    <div class="tooltip-container">
                        <input name="edge_to_${edgeCount}" placeholder="To Location" required style="flex: 2" list="node-list">
                        <div class="tooltip top">Enter the name of the destination location. Must match an existing location name</div>
                    </div>
                    <span class="help-icon" title="To location">?</span>
                </div>
                <div class="input-group">
                    <div class="tooltip-container">
                        <input name="edge_weight_${edgeCount}" type="number" min="0.1" step="0.1" placeholder="Distance" required style="flex: 1">
                        <div class="tooltip top">Enter the distance/weight between locations. Used for route optimization calculations</div>
                    </div>
                    <span class="help-icon" title="Distance">?</span>
                </div>
                <span class="remove-btn" onclick="removeItem(this, 'edge')">‚úï</span>
            `;
            div.appendChild(item);
            edgeCount++;
            document.getElementById("edge_count").value = edgeCount;
            updateVisualization();
        }

        function updateVisualization() {
            const map = document.getElementById("network-map");
            map.innerHTML = "";
            
            // Draw edges
            edges.forEach(edge => {
                const fromNode = nodes.find(n => n.id === edge.from);
                const toNode = nodes.find(n => n.id === edge.to);
                if (fromNode && toNode) {
                    const edgeElem = document.createElement("div");
                    edgeElem.className = "edge";
                    const angle = Math.atan2(toNode.y - fromNode.y, toNode.x - fromNode.x);
                    const length = Math.sqrt(
                        Math.pow(toNode.x - fromNode.x, 2) + 
                        Math.pow(toNode.y - fromNode.y, 2)
                    );
                    edgeElem.style.width = `${length}px`;
                    edgeElem.style.transform = `translate(${fromNode.x}px, ${fromNode.y}px) rotate(${angle}rad)`;
                    map.appendChild(edgeElem);
                }
            });
            
            // Draw nodes
            nodes.forEach(node => {
                const nodeElem = document.createElement("div");
                nodeElem.className = `node ${node.type.toLowerCase()}`;
                nodeElem.style.left = `${node.x}px`;
                nodeElem.style.top = `${node.y}px`;
                nodeElem.draggable = true;
                nodeElem.addEventListener("dragstart", e => {
                    e.dataTransfer.setData("text/plain", node.id);
                });
                map.appendChild(nodeElem);
            });
        }

        // Add form validation before submission
        document.getElementById("simulation-form").onsubmit = function(e) {
            e.preventDefault();
            
            // Validate at least one supply
            if (supplyCount === 0) {
                alert("Please add at least one supply item.");
                return false;
            }

            // Validate at least one vehicle
            if (vehicleCount === 0) {
                alert("Please add at least one vehicle.");
                return false;
            }

            // Validate at least one warehouse
            const nodes = document.getElementById("nodes").children;
            let hasWarehouse = false;
            for (let node of nodes) {
                const type = node.querySelector('select').value;
                if (type === 'Warehouse') {
                    hasWarehouse = true;
                    break;
                }
            }
            if (!hasWarehouse) {
                alert("Please add at least one warehouse location.");
                return false;
            }

            // If all validations pass, submit the form
            this.submit();
        };

        // Create datalist for node names
        const nodeList = document.createElement('datalist');
        nodeList.id = 'node-list';
        document.body.appendChild(nodeList);

        function updateNodeList() {
            const nodeList = document.getElementById('node-list');
            nodeList.innerHTML = '';
            const nodes = document.getElementById("nodes").children;
            for (let node of nodes) {
                const name = node.querySelector('input[name^="node_name_"]').value;
                if (name) {
                    const option = document.createElement('option');
                    option.value = name;
                    nodeList.appendChild(option);
                }
            }
        }

        // Update node list when nodes change
        const nodesContainer = document.getElementById("nodes");
        const observer = new MutationObserver(updateNodeList);
        observer.observe(nodesContainer, { childList: true, subtree: true });

        // Initialize with some example data
        addSupply();
        addVehicle();
        addNode();
        
        // Food and non-food item lists
        const foodItems = [
            'water', 'food', 'rice', 'bread', 'milk', 'juice', 'soup', 'cereal', 
            'pasta', 'beans', 'vegetables', 'fruits', 'meat', 'fish', 'eggs', 
            'cheese', 'yogurt', 'butter', 'oil', 'sugar', 'salt', 'flour', 
            'canned food', 'dried food', 'baby food', 'formula', 'snacks', 
            'chocolate', 'cookies', 'crackers', 'nuts', 'seeds', 'honey', 
            'jam', 'sauce', 'condiments', 'beverages', 'tea', 'coffee',
            'pizza', 'burger', 'sandwich', 'hot dog', 'taco', 'burrito',
            'sushi', 'salad', 'soup', 'stew', 'curry', 'noodles', 'spaghetti',
            'lasagna', 'macaroni', 'potato', 'tomato', 'onion', 'garlic',
            'carrot', 'broccoli', 'spinach', 'lettuce', 'cabbage', 'cauliflower',
            'pepper', 'cucumber', 'mushroom', 'corn', 'peas', 'beans',
            'apple', 'banana', 'orange', 'grape', 'strawberry', 'blueberry',
            'raspberry', 'blackberry', 'peach', 'pear', 'plum', 'cherry',
            'lemon', 'lime', 'grapefruit', 'pineapple', 'mango', 'papaya',
            'avocado', 'coconut', 'olive', 'raisin', 'prune', 'date',
            'beef', 'pork', 'chicken', 'turkey', 'lamb', 'duck', 'goose',
            'bacon', 'sausage', 'ham', 'pepperoni', 'salami', 'prosciutto',
            'salmon', 'tuna', 'cod', 'shrimp', 'crab', 'lobster', 'clam',
            'oyster', 'mussel', 'squid', 'octopus', 'anchovy', 'sardine',
            'cake', 'pie', 'donut', 'muffin', 'croissant', 'bagel', 'biscuit',
            'pancake', 'waffle', 'french toast', 'omelette', 'scrambled eggs',
            'fried eggs', 'boiled eggs', 'poached eggs', 'deviled eggs',
            'ice cream', 'yogurt', 'pudding', 'custard', 'jello', 'gelatin',
            'candy', 'gum', 'lollipop', 'caramel', 'toffee', 'fudge',
            'popcorn', 'chips', 'pretzel', 'cheese puff', 'corn chip',
            'salsa', 'guacamole', 'hummus', 'dip', 'spread', 'butter',
            'margarine', 'mayonnaise', 'mustard', 'ketchup', 'relish',
            'pickle', 'olive', 'caper', 'herb', 'spice', 'seasoning',
            'vinegar', 'lemon juice', 'lime juice', 'orange juice',
            'apple juice', 'grape juice', 'cranberry juice', 'tomato juice',
            'vegetable juice', 'smoothie', 'milkshake', 'hot chocolate',
            'cocoa', 'coffee', 'tea', 'herbal tea', 'green tea', 'black tea',
            'white tea', 'oolong tea', 'chai tea', 'mint tea', 'chamomile tea',
            'food', 'meal', 'nutrition', 'protein', 'vitamin', 'mineral',
            'carbohydrate', 'fat', 'fiber', 'calorie', 'nutrient', 'diet',
            'breakfast', 'lunch', 'dinner', 'snack', 'dessert', 'appetizer',
            'main course', 'side dish', 'beverage', 'drink', 'refreshment'
        ];
        
        const nonFoodItems = [
            'medicine', 'blankets', 'clothing', 'tents', 'tools', 'batteries', 
            'flashlights', 'generators', 'fuel', 'hygiene', 'soap', 'toothpaste', 
            'shampoo', 'toilet paper', 'diapers', 'bandages', 'first aid', 
            'medical supplies', 'equipment', 'machinery', 'electronics', 
            'communication', 'radios', 'phones', 'computers', 'books', 
            'educational materials', 'toys', 'games', 'sports equipment', 
            'construction materials', 'building supplies', 'furniture', 
            'bedding', 'pillows', 'mattresses', 'cooking utensils', 'pots', 
            'pans', 'plates', 'cups', 'cutlery', 'storage containers', 
            'bags', 'backpacks', 'shoes', 'boots', 'hats', 'gloves', 
            'protective gear', 'masks', 'goggles', 'helmets', 'vests',
            'blanket', 'towel', 'sheet', 'curtain', 'carpet', 'rug',
            'medicine', 'pill', 'tablet', 'capsule', 'syrup', 'ointment',
            'cream', 'lotion', 'gel', 'spray', 'inhaler', 'injection',
            'bandage', 'gauze', 'tape', 'splint', 'cast', 'brace',
            'wheelchair', 'crutch', 'walker', 'cane', 'stretcher',
            'thermometer', 'stethoscope', 'blood pressure', 'monitor',
            'defibrillator', 'oxygen', 'ventilator', 'dialysis',
            'surgical', 'scalpel', 'forceps', 'clamp', 'suture',
            'disinfectant', 'antiseptic', 'sanitizer', 'alcohol',
            'glove', 'mask', 'gown', 'cap', 'shoe cover', 'apron',
            'equipment', 'device', 'apparatus', 'instrument', 'tool',
            'machine', 'motor', 'engine', 'pump', 'compressor', 'fan',
            'heater', 'cooler', 'refrigerator', 'freezer', 'oven',
            'stove', 'microwave', 'blender', 'mixer', 'grinder',
            'drill', 'saw', 'hammer', 'screwdriver', 'wrench', 'pliers',
            'wire', 'cable', 'pipe', 'tube', 'valve', 'connector',
            'battery', 'charger', 'adapter', 'converter', 'transformer',
            'generator', 'solar panel', 'wind turbine', 'fuel cell',
            'gasoline', 'diesel', 'propane', 'natural gas', 'kerosene',
            'lamp', 'bulb', 'light', 'lantern', 'candle', 'torch',
            'radio', 'television', 'speaker', 'microphone', 'antenna',
            'phone', 'mobile', 'smartphone', 'tablet', 'laptop',
            'computer', 'printer', 'scanner', 'camera', 'projector',
            'book', 'magazine', 'newspaper', 'journal', 'manual',
            'document', 'form', 'chart', 'map', 'calendar', 'clock',
            'watch', 'timer', 'stopwatch', 'alarm', 'bell', 'whistle',
            'toy', 'game', 'puzzle', 'card', 'dice', 'board',
            'ball', 'bat', 'racket', 'net', 'goal', 'target',
            'rope', 'chain', 'cable', 'wire', 'string', 'thread',
            'fabric', 'cloth', 'textile', 'fiber', 'yarn', 'wool',
            'cotton', 'silk', 'linen', 'nylon', 'polyester', 'leather',
            'plastic', 'rubber', 'metal', 'wood', 'glass', 'ceramic',
            'paper', 'cardboard', 'foam', 'sponge', 'brush', 'broom',
            'mop', 'bucket', 'container', 'box', 'bag', 'basket',
            'shelf', 'rack', 'stand', 'table', 'chair', 'bench',
            'bed', 'mattress', 'pillow', 'cushion', 'carpet', 'rug',
            'curtain', 'blind', 'shade', 'screen', 'partition', 'wall',
            'door', 'window', 'gate', 'fence', 'barrier', 'sign',
            'label', 'tag', 'sticker', 'tape', 'glue', 'adhesive',
            'nail', 'screw', 'bolt', 'nut', 'washer', 'rivet',
            'hinge', 'lock', 'key', 'handle', 'knob', 'button',
            'switch', 'lever', 'pedal', 'wheel', 'gear', 'pulley',
            'spring', 'shock', 'damper', 'filter', 'screen', 'mesh',
            'net', 'fence', 'barrier', 'wall', 'partition', 'divider'
        ];
        
        function validateSupplyCategory(input, index) {
            const supplyName = input.value.toLowerCase().trim();
            const categorySelect = document.querySelector(`select[name="supply_category_${index}"]`);
            const errorDiv = document.getElementById(`error_${index}`);
            const foodOptions = document.getElementById(`food_options_${index}`);
            
            if (!supplyName) {
                errorDiv.style.display = 'none';
                foodOptions.style.display = 'none';
                return;
            }
            
            const isFood = foodItems.some(item => supplyName.includes(item));
            const isNonFood = nonFoodItems.some(item => supplyName.includes(item));
            
            // Always validate against current category selection
            if (categorySelect.value) {
                validateCategorySelection(categorySelect, index);
                return;
            }
            
            // Auto-select category if supply name is clear
            if (isFood && !isNonFood) {
                // This is clearly a food item
                categorySelect.value = 'food';
                toggleFoodOptions(categorySelect, index);
                errorDiv.style.display = 'none';
            } else if (isNonFood && !isFood) {
                // This is clearly a non-food item
                categorySelect.value = 'non-food';
                foodOptions.style.display = 'none';
                foodOptions.className = 'food-category non-food';
                errorDiv.style.display = 'none';
            } else if (isFood && isNonFood) {
                // Ambiguous - both food and non-food keywords found
                errorDiv.textContent = 'Ambiguous item. Please manually select the appropriate category.';
                errorDiv.style.display = 'block';
                foodOptions.style.display = 'none';
            } else {
                // Not recognized
                errorDiv.textContent = 'Item not recognized. Please check spelling or manually select category.';
                errorDiv.style.display = 'block';
                foodOptions.style.display = 'none';
            }
        }
        
        function toggleFoodOptions(select, index) {
            const foodOptions = document.getElementById(`food_options_${index}`);
            const errorDiv = document.getElementById(`error_${index}`);
            
            if (select.value === 'food') {
                foodOptions.style.display = 'block';
                foodOptions.className = 'food-category food';
                errorDiv.style.display = 'none';
            } else if (select.value === 'non-food') {
                foodOptions.style.display = 'none';
                foodOptions.className = 'food-category non-food';
                errorDiv.style.display = 'none';
            } else {
                foodOptions.style.display = 'none';
                errorDiv.style.display = 'none';
            }
        }
        
        function updateWeightPlaceholder(select, index) {
            const weightInput = document.querySelector(`input[name="supply_weight_${index}"]`);
            
            if (select.value === 'solid') {
                weightInput.placeholder = 'Weight (kg)';
            } else if (select.value === 'liquid') {
                weightInput.placeholder = 'Volume (liters)';
            } else {
                weightInput.placeholder = 'Weight';
            }
        }

        function validateCategorySelection(select, index) {
            const category = select.value;
            const supplyNameInput = document.querySelector(`input[name="supply_name_${index}"]`);
            const supplyName = supplyNameInput.value.toLowerCase().trim();
            const errorDiv = document.getElementById(`error_${index}`);
            const foodOptions = document.getElementById(`food_options_${index}`);
            
            if (category === '') {
                errorDiv.style.display = 'none';
                foodOptions.style.display = 'none';
                return;
            }
            
            // Check if supply name is provided
            if (!supplyName) {
                if (category === 'food') {
                    foodOptions.style.display = 'block';
                    foodOptions.className = 'food-category food';
                } else {
                    foodOptions.style.display = 'none';
                    foodOptions.className = 'food-category non-food';
                }
                errorDiv.style.display = 'none';
                return;
            }
            
            // Validate category against supply name
            const isFood = foodItems.some(item => supplyName.includes(item));
            const isNonFood = nonFoodItems.some(item => supplyName.includes(item));
            
            if (category === 'food') {
                if (isNonFood && !isFood) {
                    // Non-food item selected in food category - FORCE CORRECTION
                    errorDiv.textContent = 'This is a non-food item. Automatically corrected to "Non-Food" category.';
                    errorDiv.style.display = 'block';
                    select.value = 'non-food';
                    foodOptions.style.display = 'none';
                    foodOptions.className = 'food-category non-food';
                } else if (isFood && !isNonFood) {
                    // Food item correctly selected in food category
                    foodOptions.style.display = 'block';
                    foodOptions.className = 'food-category food';
                    errorDiv.style.display = 'none';
                } else if (isFood && isNonFood) {
                    // Ambiguous - both food and non-food keywords found
                    errorDiv.textContent = 'Ambiguous item. Please clarify the supply name or manually select category.';
                    errorDiv.style.display = 'block';
                    foodOptions.style.display = 'block';
                    foodOptions.className = 'food-category food';
                } else {
                    // Not recognized - allow manual selection but warn
                    errorDiv.textContent = 'Item not recognized. Please ensure correct spelling or manually select category.';
                    errorDiv.style.display = 'block';
                    foodOptions.style.display = 'block';
                    foodOptions.className = 'food-category food';
                }
            } else if (category === 'non-food') {
                if (isFood && !isNonFood) {
                    // Food item selected in non-food category - FORCE CORRECTION
                    errorDiv.textContent = 'This is a food item. Automatically corrected to "Food" category.';
                    errorDiv.style.display = 'block';
                    select.value = 'food';
                    foodOptions.style.display = 'block';
                    foodOptions.className = 'food-category food';
                } else if (isNonFood && !isFood) {
                    // Non-food item correctly selected in non-food category
                    foodOptions.style.display = 'none';
                    foodOptions.className = 'food-category non-food';
                    errorDiv.style.display = 'none';
                } else if (isFood && isNonFood) {
                    // Ambiguous - both food and non-food keywords found
                    errorDiv.textContent = 'Ambiguous item. Please clarify the supply name or manually select category.';
                    errorDiv.style.display = 'block';
                    foodOptions.style.display = 'none';
                    foodOptions.className = 'food-category non-food';
                } else {
                    // Not recognized - allow manual selection but warn
                    errorDiv.textContent = 'Item not recognized. Please ensure correct spelling or manually select category.';
                    errorDiv.style.display = 'block';
                    foodOptions.style.display = 'none';
                    foodOptions.className = 'food-category non-food';
                }
            }
        }
    </script>
</body>
</html>
